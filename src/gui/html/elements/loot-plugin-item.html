<link rel="import" href="../../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../../../bower_components/paper-tooltip/paper-tooltip.html">

<dom-module id="loot-plugin-item">
    <template>
        <style>
        /* Flip effect for user metadata / editor open icons. */
        #flipper {
            transform-style: preserve-3d;
            transition: 0.6s;
            overflow: visible;
        }
        #flipper.flipped {
            transform: rotateY(180deg);
        }
        #hasUserEdits,
        #editorIsOpen {
            display: block;
            margin-right: 0;
            backface-visibility: hidden;
        }
        #hasUserEdits {
            transform: translateZ(1px);
            position: absolute;
            top: 0;
            left: 0;
        }
        #editorIsOpen {
            transform: rotateY(180deg) translateZ(-1px);
        }

        /* paper-item (two-line) */
        paper-item {
            /* Two-line items should be 72px high according to Material Design.
               Squeeze the height to fit more items in. */
            /*height: 72px;*/
            min-height: 32px;
            line-height: 32px;
            font-size: 1rem;
        }
        :host-context(body[data-editors]) paper-item-body[two-line] {
            min-height: 40px;
        }
        #text :first-child,
        #text div[secondary],
        #text div[secondary] iron-icon,
        paper-item-body[two-line]::shadow .button-content {
            transition: 0.6s;
        }
        paper-item-body[two-line]::shadow .button-content {
            padding: 0px 16px;
        }
        :host-context(body[data-editors]) paper-item-body[two-line]::shadow .button-content {
            padding: 4.5px 16px;
        }
        #text {
            /* Padding is disabled as otherwise text won't fit in correctly. */
            /*padding: 4px 0;*/
            overflow: visible;
        }
        :host-context(body[data-editors]) #text {
            line-height: normal;
        }
        #text div[secondary] {
            /* MD spec says 14sp, but that doesn't fit, so use 12sp. */
            /*font-size: 1rem; */
            font-size: 0.857rem;
            color: var(--secondary-text-color);
            height: 13px;
            overflow: visible;
        }
        #text div[secondary] iron-icon {
            height: 13px;
        }
        iron-icon {
            color: var(--secondary-text-color);
        }

        /* When not in edit mode, hide secondary text. */
        #text div[secondary][hidden],
        :host-context(body:not([data-editors])) #text div[secondary] {
            height: 0;
            overflow: hidden;
        }

        paper-tooltip.hidden {
            opacity: 0;
            pointer-events: none;
            overflow: hidden;
        }
        </style>
        <paper-item>
            <paper-item-body two-line$="[[isEditorOpen]]">
                <div>
                    <content></content>
                </div>
                <div secondary hidden$="[[!isEditorOpen]]">
                    <iron-icon id="globalPriorityIcon" icon="star" hidden$="[[!isGlobalPriority]]"></iron-icon>
                    <paper-tooltip for="globalPriorityIcon" position="right">Global Priority</paper-tooltip>
                    <span id="priority">[[computePriority(modPriority)]]</span>
                </div>
            </paper-item-body>
            <div id="flipper" class="[[computeFlipperClass(isEditorOpen)]]">
                <iron-icon id="editorIsOpen" icon="create"></iron-icon>
                <iron-icon id="hasUserEdits" icon="account-circle" hidden$="[[!hasUserEdits]]"></iron-icon>
            </div>
            <paper-tooltip for="editorIsOpen" position="left">Editor Is Open</paper-tooltip>
            <paper-tooltip for="hasUserEdits" position="left">Has User Metadata</paper-tooltip>
        </paper-item>
    </template>
    <script>
    Polymer({
        is: 'loot-plugin-item',
        properties: {
            modPriority: {
                type: Number,
                reflectToAttribute: true,
            },
            isGlobalPriority: {
                type: Boolean,
                reflectToAttribute: true,
            },
            isEditorOpen: {
                type: Boolean,
                reflectToAttribute: true,
            },
            hasUserEdits: {
                type: Boolean,
                reflectToAttribute: true,
            },
        },

        computePriority: function(modPriority) {
            if (modPriority) {
                return modPriority;
            } else {
                return '';
            }
        },

        computeFlipperClass: function(isEditorOpen) {
            this.$.flipper.classList.toggle('flipped', isEditorOpen);
        },

        getName: function () {
            return this.textContent.trim();
        },

        onDragStart: function (evt) {
            evt.dataTransfer.effectAllowed = 'copy';
            evt.dataTransfer.setData('text/plain', evt.currentTarget.getName());
            evt.dataTransfer.setDragImage(evt.currentTarget, 325, 175);
        }
    });
    </script>
</dom-module>
